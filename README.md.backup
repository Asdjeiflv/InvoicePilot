# BillingFlow - è«‹æ±‚ç®¡ç†SaaS

Laravel 11 + Vue3 + Inertia + TypeScript + MySQLã§æ§‹ç¯‰ã•ã‚ŒãŸã€è¦‹ç©ãƒ»è«‹æ±‚ãƒ»å…¥é‡‘ãƒ»ç£ä¿ƒã‚’ä¸€æ°—é€šè²«ã§ç®¡ç†ã™ã‚‹è«‹æ±‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ğŸ“‹ æ¦‚è¦

BillingFlowã¯å°è¦æ¨¡äº‹æ¥­è€…å‘ã‘ã®åŒ…æ‹¬çš„ãªè«‹æ±‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚è¦‹ç©ä½œæˆã‹ã‚‰è«‹æ±‚ç™ºè¡Œã€å…¥é‡‘ç®¡ç†ã€ç£ä¿ƒã¾ã§ã€è«‹æ±‚æ¥­å‹™ã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

âœ… **èªè¨¼ãƒ»èªå¯**
- Laravel Breeze (Inertia + Vue3 + TypeScript)
- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (RBAC): admin, accounting, sales

âœ… **å–å¼•å…ˆç®¡ç†**
- CRUDæ“ä½œ (Controller, Routes, Policyå®Œå…¨å®Ÿè£…)
- æ¤œç´¢ãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- æ”¯æ‰•æ¡ä»¶ãƒ»ç· ã‚æ—¥è¨­å®š

âœ… **è¦‹ç©ç®¡ç†**
- è¦‹ç©ä½œæˆãƒ»æ‰¿èªãƒ•ãƒ­ãƒ¼
- æ˜ç´°è¡Œç®¡ç†ï¼ˆç¨è¨ˆç®—å¯¾å¿œï¼‰
- æ¡ç•ª: Q-YYYY-00001å½¢å¼
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†: draft / sent / approved / rejected

âœ… **è«‹æ±‚ç®¡ç†**
- è«‹æ±‚ä½œæˆï¼ˆæ‰‹å‹•ãƒ»è¦‹ç©ã‹ã‚‰ã®å¤‰æ›ï¼‰
- æ˜ç´°è¡Œç®¡ç†ï¼ˆç¨è¨ˆç®—å¯¾å¿œï¼‰
- æ¡ç•ª: I-YYYY-00001å½¢å¼
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†: draft / issued / partial_paid / paid / overdue / canceled
- PDFå‡ºåŠ›æ©Ÿèƒ½

âœ… **å…¥é‡‘ç®¡ç†**
- å…¥é‡‘ç™»éŒ²ï¼ˆéƒ¨åˆ†å…¥é‡‘å¯¾å¿œï¼‰
- è‡ªå‹•æ®‹é«˜å†è¨ˆç®—
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‡ªå‹•æ›´æ–°

âœ… **ç£ä¿ƒç®¡ç†**
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ç£ä¿ƒãƒ¡ãƒ¼ãƒ« (soft/normal/final)
- é€ä¿¡å±¥æ­´è¨˜éŒ²

âœ… **æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«**
- Polymorphicé–¢é€£ä»˜ã‘ï¼ˆè¦‹ç©ãƒ»è«‹æ±‚ã«æ·»ä»˜å¯èƒ½ï¼‰

âœ… **ç›£æŸ»ãƒ­ã‚°**
- ä¸»è¦æ“ä½œã®è¨˜éŒ²ï¼ˆä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰
- Before/AfterçŠ¶æ…‹ä¿å­˜

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Backend**: Laravel 11 (PHP 8.2+)
- **Frontend**: Vue3 + Inertia + TypeScript
- **UI**: Tailwind CSS
- **Database**: MySQL 8
- **Auth**: Laravel Breeze
- **PDF**: barryvdh/laravel-dompdf
- **Queue/Mail**: Laravelæ¨™æº–
- **Test**: PHPUnit
- **Lint/Format**: Laravel Pint

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
app/
â”œâ”€â”€ Actions/               # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆActionãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
â”‚   â”œâ”€â”€ Invoices/
â”‚   â”‚   â”œâ”€â”€ CreateInvoiceFromQuotationAction.php
â”‚   â”‚   â”œâ”€â”€ RecalculateInvoiceBalanceAction.php
â”‚   â”‚   â””â”€â”€ ChangeInvoiceStatusAction.php
â”‚   â””â”€â”€ Reminders/
â”‚       â””â”€â”€ SendReminderAction.php
â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â””â”€â”€ ClientController.php  # å®Œå…¨å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ Middleware/
â”‚   â”‚   â””â”€â”€ EnsureUserHasRole.php # ãƒ­ãƒ¼ãƒ«æ¤œè¨¼
â”‚   â””â”€â”€ Requests/
â”‚       â”œâ”€â”€ StoreClientRequest.php
â”‚       â””â”€â”€ UpdateClientRequest.php
â”œâ”€â”€ Models/                # Eloquentãƒ¢ãƒ‡ãƒ«ï¼ˆå…¨9ãƒ¢ãƒ‡ãƒ«å®Ÿè£…æ¸ˆã¿ï¼‰
â”‚   â”œâ”€â”€ Client.php
â”‚   â”œâ”€â”€ Quotation.php
â”‚   â”œâ”€â”€ QuotationItem.php
â”‚   â”œâ”€â”€ Invoice.php
â”‚   â”œâ”€â”€ InvoiceItem.php
â”‚   â”œâ”€â”€ Payment.php
â”‚   â”œâ”€â”€ Reminder.php
â”‚   â”œâ”€â”€ Attachment.php
â”‚   â””â”€â”€ AuditLog.php
â”œâ”€â”€ Policies/              # èªå¯ãƒãƒªã‚·ãƒ¼
â”‚   â””â”€â”€ ClientPolicy.php   # å®Œå…¨å®Ÿè£…æ¸ˆã¿
â””â”€â”€ Services/
    â””â”€â”€ NumberingService.php  # æ¡ç•ªãƒ­ã‚¸ãƒƒã‚¯

database/
â””â”€â”€ migrations/            # å…¨9ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…æ¸ˆã¿
```

### ERå›³ï¼ˆç°¡ç•¥ç‰ˆï¼‰

```
users
  â”œâ”€ role (admin/accounting/sales)
  â””â”€ created quotations, invoices, payments, reminders

clients
  â”œâ”€ quotations (1:N)
  â””â”€ invoices (1:N)

quotations
  â”œâ”€ quotation_items (1:N)
  â”œâ”€ invoices (1:N)
  â””â”€ attachments (polymorphic)

invoices
  â”œâ”€ invoice_items (1:N)
  â”œâ”€ payments (1:N)
  â”œâ”€ reminders (1:N)
  â””â”€ attachments (polymorphic)

payments â†’ invoice

audit_logs â†’ user, target (polymorphic)
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### å‰ææ¡ä»¶

- PHP 8.2ä»¥ä¸Š
- Composer
- Node.js 18ä»¥ä¸Š
- MySQL 8ä»¥ä¸Š
- MAMP ã¾ãŸã¯åŒç­‰ã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆã¾ãŸã¯æ—¢å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½¿ç”¨ï¼‰

```bash
cd /Applications/MAMP/InvoicePilot
```

### 2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# PHPä¾å­˜
composer install

# Nodeä¾å­˜
npm install
```

### 3. ç’°å¢ƒè¨­å®š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèªï¼ˆæ—¢ã«è¨­å®šæ¸ˆã¿ï¼‰
# ä¸»è¦ãªè¨­å®š:
# APP_NAME=BillingFlow
# DB_CONNECTION=mysql
# DB_DATABASE=invoicepilot
# DB_USERNAME=root
# DB_PASSWORD=root
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ

```bash
# MySQLã«æ¥ç¶šã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆï¼ˆæ—¢ã«ä½œæˆæ¸ˆã¿ï¼‰
# ã¾ãŸã¯ä»¥ä¸‹ã®PHPã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆ
php -r "
\$conn = new PDO('mysql:host=127.0.0.1;port=3306', 'root', 'root');
\$conn->exec('CREATE DATABASE IF NOT EXISTS invoicepilot CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci');
echo 'Database created successfully';
"
```

### 5. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
# æ—¢å­˜DBã‚’ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã«ã™ã‚‹å ´åˆ
php artisan migrate:fresh --seed

# ã¾ãŸã¯é€šå¸¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
php artisan migrate
php artisan db:seed
```

### 6. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰

```bash
# é–‹ç™ºãƒ“ãƒ«ãƒ‰
npm run dev

# ã¾ãŸã¯æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build
```

### 7. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
php artisan serve

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8000 ã«ã‚¢ã‚¯ã‚»ã‚¹
```

### 8. ãƒ­ã‚°ã‚¤ãƒ³

ãƒ‡ãƒ¢ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å…¨ã¦ `password`ï¼‰:

```
Admin: admin@example.com
Accounting: accounting@example.com
Sales: sales@example.com
```

**æ³¨æ„**: ã“ã‚Œã‚‰ã®ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ¬ç•ªç’°å¢ƒã§ã¯è‡ªå‹•ä½œæˆã•ã‚Œã¾ã›ã‚“ã€‚æœ¬ç•ªç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã¤ã„ã¦ã¯ã€Œæœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸš€ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

### å‰ææ¡ä»¶

- PHP 8.2ä»¥ä¸Šï¼ˆphp-fpmæ¨å¥¨ï¼‰
- Composer 2.x
- Node.js 18ä»¥ä¸Š
- MySQL 8ä»¥ä¸Š
- Nginx ã¾ãŸã¯ Apache
- SSLè¨¼æ˜æ›¸ï¼ˆLet's Encryptæ¨å¥¨ï¼‰
- Redisï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³/ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨ï¼‰

### 1. ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# .env.exampleã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ç·¨é›†
cp .env.example .env

# ä»¥ä¸‹ã®é …ç›®ã‚’æœ¬ç•ªç’°å¢ƒç”¨ã«è¨­å®š
```

**.env é‡è¦ãªè¨­å®šé …ç›®:**

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
APP_NAME=InvoicePilot
APP_ENV=production              # æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãš "production"
APP_KEY=                        # php artisan key:generate ã§ç”Ÿæˆ
APP_DEBUG=false                 # æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãš false
APP_TIMEZONE=Asia/Tokyo
APP_URL=https://yourdomain.com  # æœ¬ç•ªURLã«å¤‰æ›´

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=invoicepilot
DB_USERNAME=your_db_user        # rootã¯ä½¿ç”¨ã—ãªã„
DB_PASSWORD=strong_password     # å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š

# ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
SESSION_DRIVER=redis            # redisã¾ãŸã¯databaseæ¨å¥¨
SESSION_LIFETIME=120
SESSION_SECURE_COOKIE=true      # HTTPSç’°å¢ƒã§ã¯å¿…é ˆ
SESSION_SAME_SITE=lax

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
CACHE_STORE=redis               # redisæ¨å¥¨ï¼ˆé«˜é€ŸåŒ–ï¼‰

# Redisè¨­å®š
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# ãƒ¡ãƒ¼ãƒ«è¨­å®šï¼ˆç£ä¿ƒæ©Ÿèƒ½ã«å¿…è¦ï¼‰
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com        # ä½¿ç”¨ã™ã‚‹SMTPã‚µãƒ¼ãƒãƒ¼
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password # Gmailã®å ´åˆã¯ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="noreply@yourdomain.com"
MAIL_FROM_NAME="${APP_NAME}"

# ãƒ­ã‚°è¨­å®š
LOG_CHANNEL=stack
LOG_STACK=daily                 # æ—¥æ¬¡ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
LOG_LEVEL=warning               # warningã¾ãŸã¯erroræ¨å¥¨

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
BCRYPT_ROUNDS=12                # 12ä»¥ä¸Šæ¨å¥¨
```

### 2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Composerï¼ˆæœ¬ç•ªç’°å¢ƒæœ€é©åŒ–ï¼‰
composer install --optimize-autoloader --no-dev

# Node.jsï¼ˆæœ¬ç•ªãƒ“ãƒ«ãƒ‰ï¼‰
npm install
npm run build
```

### 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ç”Ÿæˆ

```bash
php artisan key:generate
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆMySQLï¼‰
mysql -u root -p
```

```sql
-- å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆrootã¯ä½¿ç”¨ã—ãªã„ï¼‰
CREATE USER 'invoicepilot_user'@'localhost' IDENTIFIED BY 'strong_password_here';

-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
CREATE DATABASE invoicepilot CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æ¨©é™ä»˜ä¸
GRANT ALL PRIVILEGES ON invoicepilot.* TO 'invoicepilot_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
php artisan migrate --force
```

**é‡è¦**: `php artisan db:seed` ã¯å®Ÿè¡Œã—ãªã„ã§ãã ã•ã„ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä½œæˆã•ã‚Œã¾ã›ã‚“ã€‚

### 5. åˆæœŸç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ

```bash
# Tinkerã§æ‰‹å‹•ä½œæˆ
php artisan tinker
```

```php
// Tinkerå†…ã§å®Ÿè¡Œ
use App\Models\User;
use Illuminate\Support\Facades\Hash;

User::factory()->admin()->create([
    'name' => 'Your Name',
    'email' => 'your@email.com',
    'password' => Hash::make('your-secure-password-here'),
]);

// è¤‡æ•°ã®ç®¡ç†è€…ã‚’ä½œæˆã™ã‚‹å ´åˆ
User::factory()->accounting()->create([
    'name' => 'Accounting User',
    'email' => 'accounting@yourdomain.com',
    'password' => Hash::make('another-secure-password'),
]);

exit
```

### 6. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒªãƒ³ã‚¯ä½œæˆ

```bash
php artisan storage:link
```

### 7. ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¨­å®š

```bash
# LaravelãŒæ›¸ãè¾¼ã¿å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
sudo chown -R www-data:www-data storage bootstrap/cache
sudo chmod -R 775 storage bootstrap/cache

# ã¾ãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ã«å¿œã˜ã¦
sudo chown -R nginx:nginx storage bootstrap/cache
```

### 8. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–

```bash
# è¨­å®šã‚­ãƒ£ãƒƒã‚·ãƒ¥
php artisan config:cache

# ãƒ«ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥
php artisan route:cache

# ãƒ“ãƒ¥ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥
php artisan view:cache

# ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥
php artisan event:cache
```

### 9. Webã‚µãƒ¼ãƒãƒ¼è¨­å®š

#### Nginxè¨­å®šä¾‹

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name yourdomain.com www.yourdomain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;

    root /var/www/InvoicePilot/public;
    index index.php index.html;

    # SSLè¨¼æ˜æ›¸
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;

    # CSPãƒ˜ãƒƒãƒ€ãƒ¼ã¯ContentSecurityPolicyãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§è¨­å®šã•ã‚Œã¾ã™

    # ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°
    access_log /var/log/nginx/invoicepilot-access.log;
    error_log /var/log/nginx/invoicepilot-error.log;

    # æœ€å¤§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º
    client_max_body_size 10M;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;

        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
        fastcgi_read_timeout 300;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }

    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### Apacheè¨­å®šä¾‹ (.htaccess)

```apache
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>
```

### 10. SSLè¨¼æ˜æ›¸å–å¾—ï¼ˆLet's Encryptï¼‰

```bash
# Certbot ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get update
sudo apt-get install certbot python3-certbot-nginx

# è¨¼æ˜æ›¸å–å¾—ï¼ˆNginxï¼‰
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# è‡ªå‹•æ›´æ–°è¨­å®šç¢ºèª
sudo systemctl status certbot.timer
```

### 11. ã‚­ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚«ãƒ¼è¨­å®šï¼ˆç£ä¿ƒãƒ¡ãƒ¼ãƒ«ç”¨ï¼‰

```bash
# Supervisorã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get install supervisor

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
sudo nano /etc/supervisor/conf.d/invoicepilot-worker.conf
```

```ini
[program:invoicepilot-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/InvoicePilot/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/InvoicePilot/storage/logs/worker.log
stopwaitsecs=3600
```

```bash
# Supervisorå†èª­ã¿è¾¼ã¿
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start invoicepilot-worker:*

# ãƒ¯ãƒ¼ã‚«ãƒ¼çŠ¶æ…‹ç¢ºèª
sudo supervisorctl status
```

### 12. Cronã‚¸ãƒ§ãƒ–è¨­å®šï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯ç”¨ï¼‰

```bash
# Crontabç·¨é›†
crontab -e
```

```cron
# Laravel Scheduler
* * * * * cd /var/www/InvoicePilot && php artisan schedule:run >> /dev/null 2>&1
```

### 13. ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `APP_ENV=production` è¨­å®šç¢ºèª
- [ ] `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `APP_DEBUG=false` è¨­å®šç¢ºèª
- [ ] `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `APP_URL` ã‚’æœ¬ç•ªURLã«è¨­å®š
- [ ] `APP_KEY` ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèªï¼ˆ`php artisan migrate:status`ï¼‰
- [ ] åˆæœŸç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå®Œäº†
- [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
- [ ] SSLè¨¼æ˜æ›¸ãŒæœ‰åŠ¹
- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ†ã‚¹ãƒˆï¼ˆç£ä¿ƒæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼‰
- [ ] ã‚­ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒç¨¼åƒä¸­ï¼ˆ`supervisorctl status`ï¼‰
- [ ] Cronã‚¸ãƒ§ãƒ–ãŒç™»éŒ²æ¸ˆã¿ï¼ˆ`crontab -l`ï¼‰
- [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãæ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å‹•ä½œï¼ˆãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆï¼‰
- [ ] CSPãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆé–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ç¢ºèªï¼‰

### 14. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šï¼ˆUFWï¼‰
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# fail2banè¨­å®šï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–ï¼‰
sudo apt-get install fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

**.envè¿½åŠ è¨­å®š:**

```bash
# Rate Limitingï¼ˆAPIã‚„ãƒ­ã‚°ã‚¤ãƒ³ã®åˆ¶é™ï¼‰
# config/auth.php, routes/web.php ã§è¨­å®š
```

### 15. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹
nano /usr/local/bin/backup-invoicepilot.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/var/backups/invoicepilot"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="invoicepilot"
DB_USER="invoicepilot_user"
DB_PASS="your_password"

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p $BACKUP_DIR

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
mysqldump -u $DB_USER -p$DB_PASS $DB_NAME | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
tar -czf $BACKUP_DIR/storage_$DATE.tar.gz /var/www/InvoicePilot/storage

# 7æ—¥ä»¥ä¸Šå‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤
find $BACKUP_DIR -type f -mtime +7 -delete

echo "Backup completed: $DATE"
```

```bash
# å®Ÿè¡Œæ¨©é™ä»˜ä¸
chmod +x /usr/local/bin/backup-invoicepilot.sh

# Crontabè¿½åŠ ï¼ˆæ¯æ—¥åˆå‰3æ™‚ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
crontab -e
```

```cron
0 3 * * * /usr/local/bin/backup-invoicepilot.sh >> /var/log/invoicepilot-backup.log 2>&1
```

### 16. æ›´æ–°æ™‚ã®æ‰‹é †

```bash
# ã‚³ãƒ¼ãƒ‰æ›´æ–°å¾Œ
cd /var/www/InvoicePilot

# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
php artisan down

# Git pullï¼ˆã¾ãŸã¯æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
git pull origin main

# Composeræ›´æ–°
composer install --optimize-autoloader --no-dev

# NPMæ›´æ–°ã¨ãƒ“ãƒ«ãƒ‰
npm install
npm run build

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
php artisan migrate --force

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
php artisan config:clear
php artisan route:clear
php artisan view:clear
php artisan cache:clear

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥å†ç”Ÿæˆ
php artisan config:cache
php artisan route:cache
php artisan view:cache

# ã‚­ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚«ãƒ¼å†èµ·å‹•
sudo supervisorctl restart invoicepilot-worker:*

# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰è§£é™¤
php artisan up
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### å•é¡Œ: "500 Internal Server Error"

```bash
# ãƒ­ã‚°ç¢ºèª
tail -f storage/logs/laravel.log

# ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
ls -la storage bootstrap/cache

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
php artisan cache:clear
php artisan config:clear
```

#### å•é¡Œ: CSPã‚¨ãƒ©ãƒ¼ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰

æœ¬ç•ªç’°å¢ƒã§ã¯ `ContentSecurityPolicy` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒè‡ªå‹•çš„ã«å³æ ¼ãªCSPã‚’è¨­å®šã—ã¾ã™ã€‚é–‹ç™ºç’°å¢ƒã¨ã¯ç•°ãªã‚Šã€`unsafe-eval` ã‚„ `unsafe-inline` ã¯è¨±å¯ã•ã‚Œã¾ã›ã‚“ã€‚

#### å•é¡Œ: ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—

```bash
# ãƒ¡ãƒ¼ãƒ«è¨­å®šãƒ†ã‚¹ãƒˆ
php artisan tinker
```

```php
Mail::raw('Test email', function ($message) {
    $message->to('test@example.com')->subject('Test');
});
```

```bash
# ãƒ­ã‚°ç¢ºèª
tail -f storage/logs/laravel.log
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```bash
# OPcacheæœ‰åŠ¹åŒ–ï¼ˆphp.iniï¼‰
opcache.enable=1
opcache.memory_consumption=256
opcache.max_accelerated_files=20000
opcache.validate_timestamps=0  # æœ¬ç•ªç’°å¢ƒã®ã¿

# Redisè¨­å®š
# config/database.php ã§Redisè¨­å®šç¢ºèª

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–
php artisan db:show
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
php artisan test

# Lintãƒã‚§ãƒƒã‚¯
./vendor/bin/pint --test

# å‹ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
npm run type-check
```

## ğŸ“Š å®Ÿè£…çŠ¶æ³

### âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼ˆå‹•ä½œç¢ºèªå¯èƒ½ï¼‰

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŸºç›¤
- [x] Laravel 11ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- [x] Laravel Breeze (Inertia + Vue + TypeScript)
- [x] RBACï¼ˆ3ãƒ­ãƒ¼ãƒ«: admin/accounting/salesï¼‰
- [x] ãƒ­ãƒ¼ãƒ«æ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- [x] Gateå®šç¾©

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [x] å…¨9ãƒ†ãƒ¼ãƒ–ãƒ«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [x] å…¨ãƒ¢ãƒ‡ãƒ« + ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
- [x] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- [x] SoftDeleteså¯¾å¿œ

#### Services & Actions
- [x] NumberingServiceï¼ˆæ¡ç•ªãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- [x] RecalculateInvoiceBalanceAction
- [x] ChangeInvoiceStatusAction
- [x] CreateInvoiceFromQuotationAction
- [x] SendReminderAction

#### Clientæ©Ÿèƒ½ï¼ˆå®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼‰
- [x] ClientControllerï¼ˆCRUDï¼‰
- [x] Routeså®šç¾©
- [x] StoreClientRequestï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- [x] UpdateClientRequestï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- [x] ClientPolicyï¼ˆèªå¯ï¼‰
- [x] ç›£æŸ»ãƒ­ã‚°çµ±åˆ

### ğŸš§ éª¨æ ¼å®Ÿè£…æ¸ˆã¿ï¼ˆæ‹¡å¼µãŒå¿…è¦ï¼‰

- [x] QuotationPolicy, InvoicePolicy, PaymentPolicyï¼ˆä½œæˆæ¸ˆã¿ã€å®Ÿè£…ãŒå¿…è¦ï¼‰
- [x] å„ç¨®FormRequestsï¼ˆä½œæˆæ¸ˆã¿ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«è¿½åŠ ãŒå¿…è¦ï¼‰

### ğŸ“ æœªå®Ÿè£…ï¼ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰æœ‰ã‚Šï¼‰

#### Quotationæ©Ÿèƒ½
- [ ] QuotationController
- [ ] Quotation CRUD Views
- [ ] æ˜ç´°è¡Œã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ç¨è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ

#### Invoiceæ©Ÿèƒ½
- [ ] InvoiceController
- [ ] Invoice CRUD Views
- [ ] è¦‹ç©â†’è«‹æ±‚å¤‰æ›UI
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´UI

#### Paymentæ©Ÿèƒ½
- [ ] PaymentController
- [ ] å…¥é‡‘ç™»éŒ²View/Modal
- [ ] æ®‹é«˜å†è¨ˆç®—çµ±åˆ

#### Reminderæ©Ÿèƒ½
- [ ] ReminderController
- [ ] ç£ä¿ƒé€ä¿¡UI
- [ ] ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†

#### PDFå‡ºåŠ›
- [ ] InvoicePDFController
- [ ] PDFãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆViewï¼ˆresources/views/pdf/invoice.blade.phpï¼‰
- [ ] æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

#### Dashboard & Reports
- [ ] DashboardController
- [ ] ReportController
- [ ] ãƒãƒ£ãƒ¼ãƒˆãƒ»ã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### ãƒ†ã‚¹ãƒˆ
- [ ] Feature Tests
- [ ] Unit Tests
- [ ] Policy Tests

#### CI/CD
- [ ] GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

## ğŸ”¨ ä»Šå¾Œã®å®Ÿè£…æ‰‹é †

### Priority 1: Quotationæ©Ÿèƒ½

```bash
# Controllerä½œæˆ
php artisan make:controller QuotationController --resource

# Policyå®Ÿè£…
# app/Policies/QuotationPolicy.php ã‚’å®Ÿè£…

# FormRequestsä½œæˆ
php artisan make:request StoreQuotationRequest
php artisan make:request UpdateQuotationRequest

# Routesè¿½åŠ ï¼ˆroutes/web.phpï¼‰
Route::resource('quotations', QuotationController::class);

# Viewsä½œæˆ
# resources/js/Pages/Quotations/Index.vue
# resources/js/Pages/Quotations/Create.vue
# resources/js/Pages/Quotations/Edit.vue
# resources/js/Pages/Quotations/Show.vue
```

**QuotationControllerå®Ÿè£…ä¾‹:**

```php
use App\Services\NumberingService;
use App\Models\Quotation;

public function store(StoreQuotationRequest $request, NumberingService $numberingService)
{
    DB::transaction(function () use ($request, $numberingService) {
        $quotation = Quotation::create([
            'quotation_no' => $numberingService->generateQuotationNumber(),
            'client_id' => $request->client_id,
            'issue_date' => $request->issue_date,
            'valid_until' => $request->valid_until,
            'status' => 'draft',
            'created_by' => auth()->id(),
        ]);

        // Create items and calculate totals
        $subtotal = 0;
        $taxTotal = 0;

        foreach ($request->items as $item) {
            $lineTotal = $item['quantity'] * $item['unit_price'];
            $subtotal += $lineTotal;
            $taxTotal += $lineTotal * ($item['tax_rate'] / 100);

            $quotation->items()->create([
                'description' => $item['description'],
                'quantity' => $item['quantity'],
                'unit_price' => $item['unit_price'],
                'tax_rate' => $item['tax_rate'],
                'line_total' => $lineTotal,
            ]);
        }

        $quotation->update([
            'subtotal' => $subtotal,
            'tax_total' => $taxTotal,
            'total' => $subtotal + $taxTotal,
        ]);

        AuditLog::log('created', Quotation::class, $quotation->id, null, $quotation->toArray());

        return $quotation;
    });
}
```

### Priority 2: Invoiceæ©Ÿèƒ½

InvoiceControllerã¯QuotationControllerã¨åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã€‚è¿½åŠ ã§ä»¥ä¸‹ã‚’å®Ÿè£…ï¼š

```php
// è¦‹ç©ã‹ã‚‰è«‹æ±‚ä½œæˆ
public function createFromQuotation(Quotation $quotation, CreateInvoiceFromQuotationAction $action)
{
    $invoice = $action->execute($quotation, [
        'issue_date' => now(),
        'due_date' => now()->addDays(30),
    ]);

    return redirect()->route('invoices.show', $invoice);
}

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
public function changeStatus(Invoice $invoice, Request $request, ChangeInvoiceStatusAction $action)
{
    $invoice = $action->execute($invoice, $request->status);
    
    return back()->with('success', 'Status updated successfully.');
}
```

### Priority 3: Paymentæ©Ÿèƒ½

```php
public function store(StorePaymentRequest $request, RecalculateInvoiceBalanceAction $action)
{
    DB::transaction(function () use ($request, $action) {
        $invoice = Invoice::findOrFail($request->invoice_id);

        // Validate payment amount
        if ($request->amount > $invoice->balance_due) {
            throw new \InvalidArgumentException('Payment amount exceeds balance due');
        }

        $payment = Payment::create([
            'invoice_id' => $invoice->id,
            'payment_date' => $request->payment_date,
            'amount' => $request->amount,
            'method' => $request->method,
            'reference_no' => $request->reference_no,
            'note' => $request->note,
            'created_by' => auth()->id(),
        ]);

        // Recalculate invoice balance and status
        $action->execute($invoice);

        AuditLog::log('payment_received', Invoice::class, $invoice->id, null, [
            'payment_id' => $payment->id,
            'amount' => $payment->amount,
        ]);

        return $payment;
    });
}
```

### Priority 4: PDFå‡ºåŠ›

```bash
# Controllerä½œæˆ
php artisan make:controller InvoicePDFController

# Blade templateä½œæˆ
# resources/views/pdf/invoice.blade.php
```

**InvoicePDFControllerå®Ÿè£…ä¾‹:**

```php
use Barryvdh\DomPDF\Facade\Pdf;

public function show(Invoice $invoice)
{
    $invoice->load(['client', 'items', 'creator']);

    $pdf = Pdf::loadView('pdf.invoice', compact('invoice'));

    return $pdf->download("invoice-{$invoice->invoice_no}.pdf");
}
```

**PDFãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¾‹ï¼ˆresources/views/pdf/invoice.blade.phpï¼‰:**

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è«‹æ±‚æ›¸ {{ $invoice->invoice_no }}</title>
    <style>
        body { font-family: 'DejaVu Sans', sans-serif; font-size: 12px; }
        .header { text-align: center; margin-bottom: 30px; }
        .invoice-info { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .total-row { font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>è«‹ æ±‚ æ›¸</h1>
    </div>

    <div class="invoice-info">
        <p><strong>è«‹æ±‚ç•ªå·:</strong> {{ $invoice->invoice_no }}</p>
        <p><strong>ç™ºè¡Œæ—¥:</strong> {{ $invoice->issue_date->format('Yå¹´mæœˆdæ—¥') }}</p>
        <p><strong>æ”¯æ‰•æœŸé™:</strong> {{ $invoice->due_date->format('Yå¹´mæœˆdæ—¥') }}</p>
    </div>

    <div class="client-info">
        <h3>{{ $invoice->client->company_name }} å¾¡ä¸­</h3>
        <p>{{ $invoice->client->address }}</p>
    </div>

    <h3>æ˜ç´°</h3>
    <table>
        <thead>
            <tr>
                <th>å“ç›®</th>
                <th>æ•°é‡</th>
                <th>å˜ä¾¡</th>
                <th>ç¨ç‡</th>
                <th>é‡‘é¡</th>
            </tr>
        </thead>
        <tbody>
            @foreach($invoice->items as $item)
            <tr>
                <td>{{ $item->description }}</td>
                <td>{{ $item->quantity }}</td>
                <td>Â¥{{ number_format($item->unit_price) }}</td>
                <td>{{ $item->tax_rate }}%</td>
                <td>Â¥{{ number_format($item->line_total) }}</td>
            </tr>
            @endforeach
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4">å°è¨ˆ</td>
                <td>Â¥{{ number_format($invoice->subtotal) }}</td>
            </tr>
            <tr>
                <td colspan="4">æ¶ˆè²»ç¨</td>
                <td>Â¥{{ number_format($invoice->tax_total) }}</td>
            </tr>
            <tr class="total-row">
                <td colspan="4">åˆè¨ˆ</td>
                <td>Â¥{{ number_format($invoice->total) }}</td>
            </tr>
        </tfoot>
    </table>
</body>
</html>
```

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

Clientæ©Ÿèƒ½ã®Viewsã‚’å‚è€ƒå®Ÿè£…ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ï¼ˆå®Ÿè£…äºˆå®šï¼‰ã€‚ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã—ã¦ãã ã•ã„ï¼š

### Index Pageï¼ˆä¸€è¦§ï¼‰

```vue
<script setup lang="ts">
import { Head, Link, router } from '@inertiajs/vue3';
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';

interface Props {
    clients: {
        data: Array<Client>;
        links: any;
        meta: any;
    };
    filters: {
        search?: string;
    };
}

const props = defineProps<Props>();

function search() {
    router.get(route('clients.index'), { search: searchQuery.value }, {
        preserveState: true,
        replace: true,
    });
}
</script>

<template>
    <AuthenticatedLayout>
        <Head title="Clients" />
        <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
        <!-- ãƒ†ãƒ¼ãƒ–ãƒ« -->
        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    </AuthenticatedLayout>
</template>
```

### Create/Edit Pageï¼ˆä½œæˆãƒ»ç·¨é›†ï¼‰

```vue
<script setup lang="ts">
import { useForm } from '@inertiajs/vue3';

const form = useForm({
    code: '',
    company_name: '',
    // ...ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
});

function submit() {
    form.post(route('clients.store'));
}
</script>

<template>
    <form @submit.prevent="submit">
        <!-- ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
        <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
        <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    </form>
</template>
```

## ğŸ§© ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ä¾‹

### LineItemsEditor.vueï¼ˆæ˜ç´°è¡Œã‚¨ãƒ‡ã‚£ã‚¿ï¼‰

```vue
<script setup lang="ts">
import { ref } from 'vue';

interface LineItem {
    description: string;
    quantity: number;
    unit_price: number;
    tax_rate: number;
    line_total: number;
}

const items = ref<LineItem[]>([
    { description: '', quantity: 1, unit_price: 0, tax_rate: 10, line_total: 0 }
]);

function addItem() {
    items.value.push({ description: '', quantity: 1, unit_price: 0, tax_rate: 10, line_total: 0 });
}

function removeItem(index: number) {
    items.value.splice(index, 1);
}

function calculateLineTotal(item: LineItem) {
    item.line_total = item.quantity * item.unit_price;
}
</script>

<template>
    <div>
        <table>
            <thead>
                <tr>
                    <th>å“ç›®</th>
                    <th>æ•°é‡</th>
                    <th>å˜ä¾¡</th>
                    <th>ç¨ç‡</th>
                    <th>å°è¨ˆ</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(item, index) in items" :key="index">
                    <td><input v-model="item.description" /></td>
                    <td><input v-model.number="item.quantity" @input="calculateLineTotal(item)" /></td>
                    <td><input v-model.number="item.unit_price" @input="calculateLineTotal(item)" /></td>
                    <td>
                        <select v-model.number="item.tax_rate">
                            <option :value="0">0%</option>
                            <option :value="8">8%</option>
                            <option :value="10">10%</option>
                        </select>
                    </td>
                    <td>{{ item.line_total }}</td>
                    <td><button @click="removeItem(index)">å‰Šé™¤</button></td>
                </tr>
            </tbody>
        </table>
        <button @click="addItem">è¡Œã‚’è¿½åŠ </button>
    </div>
</template>
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

- âœ… CSRFä¿è­·ï¼ˆLaravelæ¨™æº–ï¼‰
- âœ… SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆEloquent ORMä½¿ç”¨ï¼‰
- âœ… XSSå¯¾ç­–ï¼ˆVue + Inertiaè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
- âœ… ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- âœ… ãƒãƒªã‚·ãƒ¼ãƒ™ãƒ¼ã‚¹èªå¯
- âœ… FormRequestãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆbcryptï¼‰

### ä»Šå¾Œã®æ¨å¥¨å¯¾ç­–

- Rate Limitingï¼ˆLaravelæ¨™æº–æ©Ÿèƒ½ä½¿ç”¨ï¼‰
- 2FAèªè¨¼ï¼ˆLaravel Fortifyçµ±åˆï¼‰
- API Tokenèªè¨¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦Sanctumä½¿ç”¨ï¼‰

## ğŸ“ˆ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

### çŸ­æœŸï¼ˆ3-6ãƒ¶æœˆï¼‰

1. **å®šæœŸè«‹æ±‚æ©Ÿèƒ½**
   - æœˆæ¬¡ãƒ»å¹´æ¬¡ã®è‡ªå‹•è«‹æ±‚ä½œæˆ
   - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†

2. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å¼·åŒ–**
   - å£²ä¸Šã‚°ãƒ©ãƒ•ï¼ˆChart.jsçµ±åˆï¼‰
   - æœªåé‡‘ãƒ¬ãƒãƒ¼ãƒˆ
   - ç£ä¿ƒçŠ¶æ³ã‚µãƒãƒªãƒ¼

3. **é€šçŸ¥æ©Ÿèƒ½**
   - æœŸé™è¶…éã‚¢ãƒ©ãƒ¼ãƒˆ
   - å…¥é‡‘é€šçŸ¥
   - Slack/Emailçµ±åˆ

### ä¸­æœŸï¼ˆ6-12ãƒ¶æœˆï¼‰

1. **ä¼šè¨ˆã‚½ãƒ•ãƒˆé€£æº**
   - freee APIé€£æº
   - MFã‚¯ãƒ©ã‚¦ãƒ‰é€£æº
   - CSV/XML ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

2. **å¸³ç¥¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**
   - PDFãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚¿
   - ãƒ­ã‚´ãƒ»å°å½±è¿½åŠ 
   - è¤‡æ•°è¨€èªå¯¾å¿œ

3. **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ**
   - ä¼šç¤¾ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢
   - ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ç”»é¢

### é•·æœŸï¼ˆ12ãƒ¶æœˆä»¥ä¸Šï¼‰

1. **APIå…¬é–‹**
   - RESTful API
   - Webhook
   - API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆSwaggerï¼‰

2. **ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª**
   - React Native
   - Flutter

3. **AIæ©Ÿèƒ½**
   - ç£ä¿ƒãƒ¡ãƒ¼ãƒ«è‡ªå‹•ç”Ÿæˆ
   - å…¥é‡‘äºˆæ¸¬
   - ç•°å¸¸æ¤œçŸ¥

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ç¾åœ¨ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ãŒã€å°†æ¥çš„ã«OSSåŒ–ã‚’æ¤œè¨ä¸­ã§ã™ã€‚

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Private License - All Rights Reserved

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

è³ªå•ãƒ»ãƒã‚°å ±å‘Šã¯ Issues ã§å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚

---

**é–‹ç™ºçŠ¶æ³**: Phase 1ï¼ˆåŸºç›¤å®Ÿè£…ï¼‰å®Œäº† - 2026å¹´2æœˆ

**æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: Phase 2ï¼ˆä¸»è¦æ©Ÿèƒ½å®Ÿè£…ï¼‰- 2026å¹´3æœˆäºˆå®š
